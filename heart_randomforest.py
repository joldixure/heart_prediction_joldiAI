# -*- coding: utf-8 -*-
"""heart_randomforest.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/17b3YIMiwsVJrFiAKFzDY-i3BhKoUooRt
"""

# ===============================
# Heart Disease Decision Support Agent
# Random Forest Classifier – Full Pipeline
# ===============================

import pandas as pd
import numpy as np

from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler
from sklearn.metrics import accuracy_score, precision_score, recall_score, f1_score, confusion_matrix
from sklearn.ensemble import RandomForestClassifier

# -------------------------------
# 1. Load Dataset
# -------------------------------
data = pd.read_csv("heart.csv")  # adjust path if needed

# -------------------------------
# 2. Separate Features and Target
# -------------------------------
X = data.drop("HeartDisease", axis=1)
y = data["HeartDisease"]

# -------------------------------
# 3. Encode Categorical Features
# -------------------------------
categorical_cols = X.select_dtypes(include=["object"]).columns
X_encoded = pd.get_dummies(X, columns=categorical_cols, drop_first=True)

# -------------------------------
# 4. Train–Test Split
# -------------------------------
X_train, X_test, y_train, y_test = train_test_split(
    X_encoded,
    y,
    test_size=0.25,
    random_state=42,
    stratify=y
)

# -------------------------------
# 5. Train Random Forest
# (NO SCALING REQUIRED)
# -------------------------------
rf_model = RandomForestClassifier(
    n_estimators=300,
    max_depth=8,
    min_samples_leaf=3,
    max_features="sqrt",
    class_weight="balanced",
    random_state=42
)

rf_model.fit(X_train, y_train)

# -------------------------------
# 6. Evaluate Model
# -------------------------------
y_pred = rf_model.predict(X_test)

accuracy = accuracy_score(y_test, y_pred)
precision = precision_score(y_test, y_pred)
recall = recall_score(y_test, y_pred)
f1 = f1_score(y_test, y_pred)

print("\nRandom Forest Performance:")
print("Accuracy :", accuracy)
print("Precision:", precision)
print("Recall   :", recall)
print("F1-score :", f1)

# -------------------------------
# 7. Confusion Matrix
# -------------------------------
cm = confusion_matrix(y_test, y_pred)
print("\nConfusion Matrix:")
print(cm)

# -------------------------------
# 8. Feature Importance (KEY ADVANTAGE)
# -------------------------------
importances = pd.Series(
    rf_model.feature_importances_,
    index=X_encoded.columns
).sort_values(ascending=False)

print("\nTop 10 Most Important Features:")
print(importances.head(10))